1000 ;80 ZNAKU V MODU GR.8›1010 ;›1020 VOLANI  Z  BASICU :›1030 ; X=USR(1536,ADR(TEXT),LEN(TEXT),DRUH)›1040 ;kde-ADR(TEXT) je adresa textu›1050 ;   -LEN(TEXT) je delka textu›1060 ;   -DRUH je specifikace rozmeru znaku.›1070 ;›1080 ;Promenne OS:›1090 ;›1100 OLDCOL = $5B    ;sloupec gr. kurzoru›1110 OLDADR = $5E    ;adr.gr.kurzoru ve VRAM›1120 CHBAS = $02F4   ;ukazatel znakove sady v ROM›1130 ;›1140 ;Pomocne promenne:›1150 ;›1160 TEXT =  $D0     ;adresa textu›1170 LEN =   $D2     ;delka textu›1180 DRUH =  $D6     ;rozmer znaku›1190 NOTVAR = $D8    ;uprav. tvar znaku›1200 TCOL =  $D4     ;pomocny textovy kurzor›1210 POMKUR = $CB    ;adr. POMKUR ve VRAM›1220 TVAR =  $CE     ;adresa tvaru znaku v ROM›1230 POM2 =  $D5     ;pomocna adresa›1240 POM3 =  $D3     ;      -"-›1250 POM4 =  $CD     ;      -"-›1260 POM5 =  $D7     ;      -"-›1270 ;›1280 ;  *=$0600›1290 ;›1300 ;Start programu, prevzeti parametru›1310 ;›1320 ZAC PLA         ;pocet parametru›1330     PLA         ;adresa textu›1340     STA TEXT+1  ;do TEXT›1350     PLA ›1360     STA TEXT›1370     PLA ›1380     PLA         ;delka textu›1390     STA LEN     ;do LEN›1400     PLA ›1410     PLA         ;druh znaku›1420     STA DRUH    ;do DRUH›1430 ;›1440 ;Priprava pomocnych promennych›1450 ;›1460     LDA #0      ;nuluj›1470     STA POM3›1480     STA POM4›1490     STA POM2›1500 ;›1510 ;Vypocet polohy text. kurzoru z polohy›1520 ;grafickeho kurzoru›1530 ;›1540     LDA OLDCOL+1 ;polohu graf. kurzoru›1550     STA NOTVAR›1560     LDA OLDCOL›1570     ROR NOTVAR  ;vydel cislem '4'›1580     ROR A›1590     ROR NOTVAR›1600     ROR A›1610     STA TCOL    ;uloz do TCOL›1620 ;›1630 ;Overeni pripustne polohy text. kurzoru›1640 ;80 znaku=>TCOL...<0;79>›1650 ;›1660 TEST LDA TCOL   ;porovnej TCOL›1670     CMP #80     ;s cislem 80›1680     BCS NAVRAT  ;TCOL>80,navrat do BASICu›1690     ROR A       ;TCOL v poradku›1700     ROR POM2›1710     LDA OLDADR  ;uloz polohu adr. gr. kurzoru›1720     STA POMKUR  ;ve VRAM›1730     LDA OLDADR+1›1740     STA POMKUR+1 ;do POMKUR›1750 ;›1760 ;Prevod ATASCII->SCREEN kod›1770 ;›1780     LDY #0      ;nuluj vyssi bajt adresy›1790     STY TVAR+1  ;adresy tvaru›1800     LDY POM3›1810     LDA (TEXT),Y ;ASCII kod znaku textu›1820     AND #$7F    ;inverzni znak->norm. znak›1830     CMP #96     ;male pismeno?›1840     BCS POCITEJ ; ano, kod o.k.›1850     CMP #32     ;velke pismeno?›1860     BCS VELKE   ; ano!›1870     ORA #64     ;graf.znak, pricti '64'›1880     BNE POCITEJ›1890 VELKE SEC       ;velke pismeno =>›1900     SBC #32     ;odecti '32'›1910 ;›1920 ;Vypocet adresy znaku v ROM›1930 ;›1940 POCITEJ ASL A   ;SCREEN kod nasob '8'›1950     ASL A       ;(8 bajtu...1 znak)›1960     ROL TVAR+1›1970     ASL A›1980     ROL TVAR+1›1990     STA TVAR    ;vysledek do TVAR›2000     CLC         ;priprava na scitani›2010     LDA TVAR+1  ;pricti adresu znakove›2020     ADC CHBAS   ;sady v ROM, uloz do TVAR›2030     STA TVAR+1›2040 ;›2050 ;Uprava a zobrazeni znaku›2060 ;›2070     LDX #8      ;8x proved,(1 znak ... 8 bajtu)›2080 ZNAK LDY #0›2090     LDA (TVAR),Y ;bajt tvaru znaku›2100     BIT DRUH    ;jaky druh znaku?›2110     BPL NOSIR   ;7.bit=0...norm. sirka›2120     JSR UPRAV   ;7.bit=1...polovicni sirka›2130 NOSIR JSR ULOZ  ; zobraz bajt›2140     BIT DRUH    ;jaka vyska znaku?›2150     BVC NOVYS   ;6.bit=0...norm. vyska›2160     JSR ULOZ    ;6.bit=1...dvojita vyska›2170 NOVYS INC TVAR  ;dalsi bajt tvaru znaku›2180     DEX ›2190     BNE ZNAK    ;jeste nezprac. cely znak›2200     INC TCOL    ;posun textovy kurzor›2210     BIT DRUH    ;jaka sirka?›2220     BPL NOSIR1  ;normalni›2230     BIT POM2    ;licha ci suda poloha kurzoru?›2240     BMI LICHA   ;7.bit POM2=1...licha›2250     BPL SUDA    ;7.bit POM2=0...suda›2260 NOSIR1 INC TCOL ;jeste posun kurzor›2270 LICHA INC POM4›2280 SUDA INC POM3›2290     DEC LEN     ;delka textu -1›2300     BNE TEST    ;nezprac. cely text›2310 NAVRAT RTS      ;text zpracovan,navrat do BAS.›2320 ;›2330 ;Podprogram zuzeni znaku›2340 ;›2350 UPRAV STA POM5  ;tvar znaku do POM5›2360     LDA #0      ;nuluj›2370     STA NOTVAR  ;NOTVAR›2380     LDY #3›2390 UPRAV2 LDA MASK1,Y ;maskuj tvar znaku›2400     BIT POM5›2410     BEQ UPRAV3  ;bit znaku nulovy›2420     LDA MASK2,Y ;testovany bit nastaven,›2430     ORA POM6    ;nastav prisl. bit zuzeneho›2440     STA POM6    ;tvaru znaku›2450 UPRAV3 DEY      ;dalsi bit›2460     BPL UPRAV2  ;tvaru znaku›2470     LDA NOTVAR›2480     BIT POM2    ;licha ci suda pozice?›2490     BMI UPRAV4  ;licha (prava)›2500     ASL A       ;suda (leva), posun›2510     ASL A       ;doprava›2520     ASL A›2530     ASL A›2540 UPRAV4 RTS ›2550 ;›2560 ;Pomocne masky›2570 ;›2580 MASK1 .BYTE 1   ;bin:00000001›2590     .BYTE 4     ;bin:00000100›2600     .BYTE 16    ;bin:00010000›2610     .BYTE 32    ;bin:00100000›2620 MASK2 .BYTE 1   ;bin:00000001›2630     .BYTE 2     ;bin:00000010›2640     .BYTE 4     ;bin:00000100›2650     .BYTE 8     ;bin:00001000›2660 ;›2670 PODPROGRAM  ZOBRAZENI  ZNAKU›2680 ;›2690 ULOZ PHA        ;odloz tvar znaku do zasobniku›2700     LDY POM4›2710     ORA (POMKUR),Y ;sluc tvar znaku s pu-›2720     STA (POMKUR),Y ;vodnim obsahem obrazu›2730     ;           a uloz na obrazovku›2740     CLC         ;priprava na soucet›2750     LDA POMKUR›2760     ADC #40     ;dalsi graf. radek obrazovky›2770     STA POMKUR›2780     BCC ULOZ1›2790     INC POMKUR+1›2800 ULOZ1 PLA       ;vyzvedni tvar znaku›2810     RTS         ;a vrat se›2820 ;›