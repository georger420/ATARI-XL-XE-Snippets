0900 ; .OPT OBJ›0910 ;›0920     .TITLE "***** PSANI *****"›0930 ;›0940     .SET 1,6›0950     .SET 3,0›0960     .SET 4,72›0970 ;›1000 ***********************************›1010 * Ð ï ä ð ò ï ç ò á í   Ð Ó Á Î É *›1020 * Volani:                         *›1030 * x=usr(psani,adr(font$),zacx,    *›1040 *       zacy,vx,vy,rot,znak)      *›1050 ***********************************›1060 ;›1500 ;Promenne:›1510 ;›1520 OFSET = $D4›1530 COLCRS = $55›1540 ROWCRS = $54›1550 STOCOL = $CD›1560 ICCOM = $0342›1570 ICBL =  $0348›1580 CIOV =  $E456›1590 ;›1900     *=  $5600›1910 ;›2000 ;Preneseni parametru do zasobniku›2010 ;›2020 PSANI PLA ›2030     PLA ›2040     STA FONT+1›2050     PLA ›2060     STA FONT›2070 ;›2080     PLA ›2090     STA ZACX+1›2100     PLA ›2110     STA ZACX›2120 ;›2130     PLA ›2140     PLA ›2150     STA ZACY›2160 ;›2170     PLA ›2180     PLA ›2190     STA VX›2200 ;›2210     PLA ›2220     PLA ›2230     STA VY›2240 ;›2250     PLA ›2260     PLA ›2270     STA ROT›2280 ;›2290     PLA ›2300     PLA ›2310     STA ZNAK›2320     JSR VYPOCET›2330 ;›2620 ;›2630 ;Preneseni 8 bitu znaku do pole›2640 ;›2650     LDY #7›2660 PRENES LDA (OFSET),Y›2670     STA POLE,Y›2680     DEY ›2690     BPL PRENES›2710 ;›2720 ;Inverze znaku›2730 ;›2740     LDA INV›2750     BEQ OTACENI›2760     LDX #7›2770 INVERZE1 LDA POLE,X›2780     EOR #$FF›2790     STA POLE,X›2800     DEX ›2810     BPL INVERZE1›2830 ;›2840 ;Otaceni znaku o 90 stupnu vlevo›2850 ;›2860 OTACENI LDA ROT›2870     BEQ OTACENI3›2880 OTACENI2 JSR OTOC›2890     DEC ROT›2900     BNE OTACENI2›2905 OTACENI3 JMP KRESLI›2910 ;›3110 ;VYKRESLENI ZNAKU:›3120 ;›3130 KRESLI LDA #0›3140     STA II›3150 KRESLI1 LDX II›3170     LDA POLE,X›3180     STA BAJT›3190     LDA #0›3200     STA JE›3210 KRESLI2 LDX JE›3220     LDA BAJT›3230     AND MASK,X›3240     BEQ KRESLI7›3250     LDA #0›3260     STA EL›3270 KRESLI3 LDA #0›3280     STA KA›3290 KRESLI4 LDA ZACX›3300     CLC ›3310     ADC KA›3320     STA COLCRS›3330     LDA ZACX+1›3340     ADC #0›3350     STA COLCRS+1›3360     LDA ZACY›3370     CLC ›3380     ADC EL›3390     STA ROWCRS›3400 ;›3410     JSR VYPLOT›3420 ;›3680 ;›3690     INC KA›3700     LDA KA›3710     CMP VX›3720     BNE KRESLI4›3730 ;›3740     INC EL›3750     LDA EL›3760     CMP VY›3770     BNE KRESLI3›3780 ;›3790 KRESLI7 INC JE›3800     LDA JE›3810     CMP #8›3820     BNE KRESLI2›3830 ;›3840     INC II›3850     LDA II›3860     CMP #8›3870     BNE KRESLI1›3880 ;›3890 NAVRAT RTS ›3900 ;›3910 ;Podprogram nasobeni›3920 ;›3930 MULT STX MDATA1›3940     LSR A›3950     STA MDATA2›3960     LDX #8›3970     LDA #0›3980 MULT1 BCC MULT2›3990     CLC ›4000     ADC MDATA1›4010 MULT2 ROR A›4020     ROR MDATA2›4030     DEX ›4040     BNE MULT1›4050     LDX MDATA2›4060     RTS ›4070 ;›4080 ;›4090 ;›5000 VYPLOT LDA JE›5010     LDX VX›5020     JSR MULT›5030     TXA ›5040     CLC ›5050     ADC COLCRS›5060     STA COLCRS›5070     LDA COLCRS+1›5080     ADC #0›5090     STA COLCRS+1›5100 ;›5110     LDA II›5120     LDX VY›5130     JSR MULT›5140     TXA ›5150     CLC ›5160     ADC ROWCRS›5170     STA ROWCRS›5180 ;›5190     LDX #$60›5200     LDA #$0B›5210     STA ICCOM,X›5220     LDA #0›5230     STA ICBL,X›5240     STA ICBL+1,X›5250     LDA #1›5260     JSR CIOV›5270     RTS ›5280 ;›6000 OTOC LDA #0›6010     LDX #7›6020 OTOC1 STA BUFER,X›6030     DEX ›6040     BPL OTOC1›6050 ;›6060     LDA #0›6070     STA II›6080 OTOC3 LDX II›6090     LDA POLE,X›6100     STA BAJT›6110     LDA #0›6120     STA JE›6130 OTOC2 LDX JE›6140     LDA BAJT›6150     AND MASK,X›6160     BEQ OTOC5›6170     LDA #7›6180     SEC ›6190     SBC JE›6200     TAY ›6210     LDA BUFER,Y›6220     LDX II›6230     ORA MASK,X›6240     STA BUFER,Y›6250 ;›6260 OTOC5 INC JE›6270     LDA JE›6280     CMP #8›6290     BNE OTOC2›6300     INC II›6310     LDA II›6320     CMP #8›6330     BNE OTOC3›6340 ;›6350     LDX #7›6360 OTOC4 LDA BUFER,X›6370     STA POLE,X›6380     DEX ›6390     BPL OTOC4›6400     RTS ›6410 ;›6420     *=  $0620›6430 ;›7000 ;Vypocet adresy znaku ve FONT$›7005 ;›7010 VYPOCET LDA ZNAK›7020     AND #$80›7030     STA INV     ;›7040     LDA #0›7050     STA OFSET›7060     STA OFSET+1›7070     LDA ZNAK›7080     AND #$7F›7090     CMP #96›7100     BCS POCITEJ›7110     CMP #32›7120     BCS VELKE›7130     ORA #64›7140     BNE POCITEJ›7150 VELKE SEC ›7160     SBC #32›7170 POCITEJ ASL A›7180     ASL A›7190     ROL OFSET+1›7200     ASL A›7210     ROL OFSET+1›7220     STA OFSET›7230     CLC ›7240     ADC FONT›7250     STA OFSET›7260     LDA OFSET+1›7270     ADC FONT+1›7280     STA OFSET+1›7290     RTS ›8000 FONT .WORD 0›8010 ZACX .WORD 0›8020 ZACY .BYTE 0›8030 VX  .BYTE 0›8040 VY  .BYTE 0›8050 ROT .BYTE 0›8060 ZNAK .BYTE 0›8070 II  .BYTE 0›8080 JE  .BYTE 0›8090 EL  .BYTE 0›8100 KA  .BYTE 0›8110 INV .BYTE 0›8120 MDATA1 .BYTE 0›8130 MDATA2 .BYTE 0›8140 BUFER .WORD 0,0,0,0›8150 MASK .BYTE 128,64,32,16,8,4,2,1›8160 BAJT .BYTE 0›8170 POLE .WORD 0,0,0,0›8180 ;›8190 ZZZZZZZ›